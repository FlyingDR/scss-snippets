@import "compass/typography/units";
@import "spacer";

$use-rem: true !default;

@function rv($value) {
    @if (unit($value) == '') {
        @if ($value != 0) {
            @warn 'Unitless value is passed to rv(), treating it as px';
        }
        $value: $value * 1px;
    }
    @return convert-length($value, rem);
}

@function px($value) {
    $unit: unit($value);
    @if ($unit == '') {
        @return $value * 1px;
    } @else if ($unit != 'px') {
        @return convert-length($value, px);
    } @else {
        @return $value;
    }
}

@function parse-important($value) {
    $important: false;
    @if (type-of($value) == list and index($value, !important) == length($value)) {
        $important: true;
        $nv: ();
        @for $i from 1 through length($value) - 1 {
            $nv: append($nv, nth($value, $i));
        }
        $value: $nv;
    }
    @return ($value, $important);
}

@function v($value) {
    $parsed: parse-important($value);
    $value: nth($parsed, 1);
    $important: nth($parsed, 2);
    $result: ();
    @each $v in $value {
        @if ((type-of($v) == number) and unitless($v) and $v != 0) {
            $v: spacer($v);
        } @else if (type-of($v) == number and unit($v) == '%') {
            $v: $v;
        } @else if ($use-rem and (unit($v) != 'rem')) {
            $v: rv($v);
        } @else if ((not $use-rem) and (unit($v) != 'px')) {
            $v: px($v);
        }
        $result: append($result, $v);
    }
    @if ($important) {
        $result: append($result, !important);
    }
    @return $result;
}

@function uround($value) {
    @if (not $use-rem) {
        $value: round($value);
    }
    @return $value;
}

@function centered($total, $size, $compensation: 0) {
    @return uround((v($total) - v($size)) / 2) + v($compensation);
}
