@import "susy";
@import "spacer";
@import "box";

%page-section {
    @include container();
    @include full();
    @include break();
    float: none;
    margin: 0 auto;
    @if (mixin-exists(r-each-if)) {
        //noinspection SassScssResolvedByNameOnly
        @include r-each-if(layout, layout) {
            @include container();
            @if (r-has(page-padding)) {
                padding: 0 v(r-get(page-padding, 0));
            }
        }
    }
}

// Declare vertical margins and background for page section
//
// @param int|string|list $top  Either top margin or list with one or more parameters for mixin
// @param int|string $bottom    Bottom margin
// @param mixed $bg             Background for section
@mixin section($top: null, $bottom: null, $bg: null) {
    @if (type-of($top) == list) {
        $map: $top;
        $l-bottom: $bottom;
        $l-bg: $bg;
        @if (length($map) == 1) {
            $top: nth($map, 1);
            $bottom: $l-bottom;
            $bg: $l-bg;
        } @else if (length($map) == 2) {
            $top: nth($map, 1);
            $bottom: nth($map, 2);
            @if ($l-bottom != null) {
                $bg: $l-bottom;
            } @else {
                $bg: $l-bg;
            }
        } @else if (length($map) == 3) {
            $top: nth($map, 1);
            $bottom: nth($map, 2);
            $bg: nth($map, 3);
        } @else {
            @error "section() argument should contain 1..3 items if passed as list of values";
        }
    }
    @if ($top != null) {
        @if (type-of($top) == number) {
            $top: spacer($top);
        }
        @if ($bg) {
            padding-top: $top;
        } @else {
            margin-top: $top;
        }
    }
    @if ($bottom != null) {
        @if (type-of($bottom) == number) {
            $bottom: spacer($bottom);
        }
        @if ($bg) {
            padding-bottom: $bottom;
        } @else {
            margin-bottom: $bottom;
        }
    }
    @if ($bg != null) {
        background: $bg;
    }
}

// Section information declaration with responsive modifications
//
// @param string $key           Responsive configuration key to get information from
// @param int|string|list $top  Either top margin or list with one or more parameters for mixin
// @param int|string $bottom    Bottom margin
// @param mixed $bg             Background for section
@mixin r-section($key, $top: null, $bottom: null, $bg: null) {
    @include section($top, $bottom, $bg);
    @if (mixin-exists(r-each)) {
        //noinspection SassScssResolvedByNameOnly
        @include r-each() {
            @if (r-has($key + '/section') or r-has($key + '/layout')) {
                @if (r-has($key + '/section')) {
                    @include section(r-get($key + '/section'));
                }
                @if (r-has($key + '/layout')) {
                    @include with-layout(r-get($key + '/layout')) {
                        @content;
                    }
                }
                @if (r-has($key + '/span')) {
                    @include span(r-get($key + '/span'));
                }
                @if (r-has($key + '/margin')) {
                    @include margin(r-get($key + '/margin'));
                }
                @if (r-has($key + '/padding')) {
                    @include padding(r-get($key + '/padding'));
                }
            } @else {
                @if (r-has($key)) {
                    @include section(r-get($key));
                }
            }
        }
    }
}
